<mat-tree [dataSource]="dataSource" [treeControl]="treeControl">

  <!-- This is the tree node template for leaf nodes -->
  <mat-tree-node *matTreeNodeDef="let node" [ngClass]="{active: node.active}" class="d-flex flex-row align-items-center">

    <span *ngFor="let i of getLevelTabs(node.level)" [ngClass]="{
      'line-right': (i === node.level - 1 && !node.active),
      'line-right-active': (i === node.level - 1 && node.active),
      'line-straight': (i !== node.level - 1 && (node.parent == null || !node.parent.last)),
      'line-end': i === node.level - 1 && node.last && !node.active,
      'line-end-active': i === node.level - 1 && node.last && node.active,
      'line-empty': node.parent && node.parent.last
    }"></span>

    <span class="node-name flex-grow-1" (click)="onNodeClicked(node)">
      <mat-icon *ngIf="node.icon">{{node.icon}}</mat-icon>
      <mat-icon *ngIf="node.icon == null">radio_button_unchecked</mat-icon>
      {{node.name}}
    </span>

    <span class="leaf-end"></span>

  </mat-tree-node>

  <!-- This is the tree node template for expandable nodes -->
  <mat-tree-node *matTreeNodeDef="let node; when: hasChild" class="d-flex flex-row align-items-center" [ngClass]="{active: node.active}">

    <span *ngFor="let i of getLevelTabs(node.level)" [ngClass]="{
      'line-right': (i < node.level && !node.last) || (i !== node.level - 1 && node.last) || treeControl.isExpanded(node),
      'line-right-active': (i === node.level - 1 && node.active),
      'line-straight': (i !== node.level - 1 && (node.parent == null || !node.parent.last)),
      'line-end': node.last,
      'line-end-active': i === node.level - 1 && node.last && node.active
    }"></span>

    <span class="node-name flex-grow-1" (click)="onNodeClicked(node)">
      <mat-icon *ngIf="node.icon">{{node.icon}}</mat-icon>
      <mat-icon *ngIf="node.icon == null">folder_open</mat-icon>
      {{node.name}}
    </span>

    <span class="expand-collapse" matTreeNodeToggle>
      <mat-icon *ngIf="!treeControl.isExpanded(node)" title="unfold">expand_more</mat-icon>
      <mat-icon *ngIf="treeControl.isExpanded(node)" title="fold">expand_less</mat-icon>
    </span>

  </mat-tree-node>

</mat-tree>
